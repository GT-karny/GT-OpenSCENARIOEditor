# ASAM OpenSCENARIO Editor - Architecture & Plan

## Context

ASAM OpenSCENARIO XML v1.2ã®ã‚·ãƒŠãƒªã‚ªã‚’ã€Webãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ã«ä½œæˆãƒ»ç·¨é›†ã§ãã‚‹ã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ç™ºã™ã‚‹ã€‚OpenSCENARIOã«è©³ã—ããªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ç›´æ„Ÿçš„ã«ã‚·ãƒŠãƒªã‚ªã‚’æ§‹ç¯‰ã§ãã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®å”èª¿ä½œæ¥­ã‚‚å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ã‚’ç›®æŒ‡ã™ã€‚

**èª²é¡Œ**: æ—¢å­˜ã®OpenSCENARIOã‚¨ãƒ‡ã‚£ã‚¿ã¯å°‘ãªãã€XMLæ‰‹æ›¸ãã¯éåŠ¹ç‡ã§ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã‚„ã™ã„ã€‚Webãƒ™ãƒ¼ã‚¹ã§ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ãªã‚‚ã®ã¯ã»ã¼å­˜åœ¨ã—ãªã„ã€‚

**ç›®æ¨™**: ãƒãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹+ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ç·¨é›†UIã€3Dãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€AIã‹ã‚‰ã®æ“ä½œï¼ˆMCPï¼‰ã€esminiãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‚™ãˆãŸç·åˆã‚¨ãƒ‡ã‚£ã‚¿ã€‚

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | é¸å®šæŠ€è¡“ |
|---------|---------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | React + TypeScript + Vite |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | Node.js + TypeScript (Fastify) |
| ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ— | Tauriï¼ˆå°†æ¥ãƒ•ã‚§ãƒ¼ã‚ºï¼‰ |
| 3Dæç”» | Three.js + React Three Fiber |
| ãƒãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ | React Flow (@xyflow/react v12) |
| UI | shadcn/ui + Tailwind CSS |
| çŠ¶æ…‹ç®¡ç† | Zustand (React Flowã¨åŒã˜é¸æŠ) |
| ãƒ†ã‚¹ãƒˆ | Vitest (unit) + Playwright (E2E) |
| i18n | i18next + react-i18next (è‹±èª+æ—¥æœ¬èª) |
| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç† | pnpm workspaces (ãƒ¢ãƒãƒ¬ãƒ) |
| XMLãƒ‘ãƒ¼ã‚¹ | fast-xml-parser |
| å¯¾è±¡è¦æ ¼ | OpenSCENARIO XML v1.2 / OpenDRIVE v1.6 |

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  GT-OpenSCENARIOEditor                    â”‚
â”‚                   (pnpm monorepo)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  packages/                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ @osce/shared â”‚  â”‚ @osce/openscenarioâ”‚                  â”‚
â”‚  â”‚ å‹å®šç¾©ãƒ»å¥‘ç´„  â”‚â†â”€â”‚ xoscãƒ‘ãƒ¼ã‚µãƒ¼/     â”‚                  â”‚
â”‚  â”‚ enumãƒ»i18nã‚­ãƒ¼â”‚  â”‚ ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶/     â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€^â”€â”€â”€â”€â”€â”€â”˜  â”‚ ãƒãƒªãƒ‡ãƒ¼ã‚¿        â”‚                  â”‚
â”‚         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€^â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                  â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚@osce/       â”‚  â”‚@osce/scenario-   â”‚                   â”‚
â”‚  â”‚ opendrive   â”‚  â”‚  engine          â”‚                   â”‚
â”‚  â”‚ xodrãƒ‘ãƒ¼ã‚µãƒ¼ â”‚  â”‚ ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«CRUD  â”‚                   â”‚
â”‚  â”‚ é“è·¯å½¢çŠ¶è¨ˆç®— â”‚  â”‚ Command/Undo    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€^â”€â”€â”€â”€â”€â”€â”˜  â”‚ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ   â”‚                   â”‚
â”‚         â”‚         â”‚ è‡ªå‹•æ•´åˆ         â”‚                   â”‚
â”‚         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€^â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚@osce/       â”‚  â”‚@osce/node-editor â”‚                   â”‚
â”‚  â”‚ 3d-viewer   â”‚  â”‚ React Flow       â”‚                   â”‚
â”‚  â”‚ Three.jsæç”»â”‚  â”‚ ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰    â”‚                   â”‚
â”‚  â”‚ é“è·¯/è»Šä¸¡   â”‚  â”‚ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åŒæœŸ  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚@osce/       â”‚  â”‚@osce/esmini      â”‚                   â”‚
â”‚  â”‚ mcp-server  â”‚  â”‚ ã‚µãƒ–ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†  â”‚                   â”‚
â”‚  â”‚ AIé€£æº      â”‚  â”‚ .datãƒ‘ãƒ¼ã‚¹       â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°    â”‚                   â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚@osce/       â”‚  â”‚@osce/i18n        â”‚                   â”‚
â”‚  â”‚ templates   â”‚  â”‚ è‹±èª/æ—¥æœ¬èª      â”‚                   â”‚
â”‚  â”‚ ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ â”‚  â”‚ ç¿»è¨³            â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                          â”‚
â”‚  apps/                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ apps/web    â”‚  â”‚ apps/server      â”‚                   â”‚
â”‚  â”‚ Reactã‚¢ãƒ—ãƒª â”‚â†â†’â”‚ Node.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰â”‚                   â”‚
â”‚  â”‚ ãƒ¡ã‚¤ãƒ³UI    â”‚  â”‚ ãƒ•ã‚¡ã‚¤ãƒ«I/O      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ esminiãƒ—ãƒ­ã‚»ã‚¹   â”‚                   â”‚
â”‚                   â”‚ WebSocket        â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”‚apps/desktop â”‚                                         â”‚
â”‚  â”‚ Tauri(å°†æ¥) â”‚                                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€šä¿¡ãƒ•ãƒ­ãƒ¼

```
ãƒ–ãƒ©ã‚¦ã‚¶ (React)
  â”œâ”€â”€ WebSocket â”€â”€â†’ apps/server (Node.js)
  â”‚                    â”œâ”€â”€ child_process.spawn â†’ esmini.exe (headless)
  â”‚                    â”œâ”€â”€ ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ  (.xosc, .xodr)
  â”‚                    â””â”€â”€ MCP Server (stdio/SSE)
  â”‚
  â”œâ”€â”€ Zustand Store (ãƒ–ãƒ©ã‚¦ã‚¶å†…çŠ¶æ…‹)
  â”‚     â”œâ”€â”€ @osce/scenario-engine (ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã€ã‚³ãƒãƒ³ãƒ‰)
  â”‚     â”œâ”€â”€ @osce/openscenario (ãƒ‘ãƒ¼ã‚¹/ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º)
  â”‚     â””â”€â”€ @osce/opendrive (é“è·¯ãƒ‘ãƒ¼ã‚¹)
  â”‚
  â”œâ”€â”€ React Flow (ãƒãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ãƒ‘ãƒãƒ«)
  â”œâ”€â”€ Three.js Canvas (3Dãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ‘ãƒãƒ«)
  â””â”€â”€ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‘ãƒãƒ« (åŒæœŸãƒ“ãƒ¥ãƒ¼)
```

---

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆã¨è²¬å‹™

### `packages/shared` (@osce/shared) â€” å¥‘ç´„ã®ä¸­æ ¸
å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä¾å­˜ã™ã‚‹å‹å®šç¾©ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€‚**å¤–éƒ¨ä¾å­˜ãªã—ï¼ˆç´”ç²‹TypeScriptå‹ã®ã¿ï¼‰**

ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«:
- `types/scenario.ts` â€” ScenarioDocumentï¼ˆãƒ«ãƒ¼ãƒˆãƒ¢ãƒ‡ãƒ«ï¼‰
- `types/entities.ts` â€” Vehicle, Pedestrian, MiscObject
- `types/storyboard.ts` â€” Story, Act, ManeuverGroup, Maneuver, Event
- `types/actions.ts` â€” å…¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‹ï¼ˆåˆ¤åˆ¥å…±ç”¨ä½“ï¼‰
- `types/triggers.ts` â€” Trigger, Condition, ConditionGroup
- `types/positions.ts` â€” ä½ç½®å‹ï¼ˆåˆ¤åˆ¥å…±ç”¨ä½“ï¼‰
- `types/opendrive.ts` â€” OpenDRIVEå†…éƒ¨ãƒ¢ãƒ‡ãƒ«
- `types/component-library.ts` â€” ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå‹
- `interfaces/scenario-service.ts` â€” IScenarioServiceï¼ˆCRUDæ“ä½œï¼‰
- `interfaces/parser-service.ts` â€” IXoscParser, IXoscSerializer, IXodrParser
- `interfaces/command.ts` â€” ICommandï¼ˆUndo/Redoï¼‰

### `packages/openscenario` (@osce/openscenario)
.xosc XML â†” å†…éƒ¨ãƒ¢ãƒ‡ãƒ«å¤‰æ›ã€‚ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
- ä¾å­˜: `fast-xml-parser`, `@osce/shared`
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: `Thirdparty/openscenario-v1.2.0/Examples/*.xosc`, `Thirdparty/esmini-demo_Windows/esmini-demo/resources/xosc/`

### `packages/opendrive` (@osce/opendrive)
.xodr XMLãƒ‘ãƒ¼ã‚¹ã€é“è·¯å½¢çŠ¶è¨ˆç®—ï¼ˆå‚ç…§ç·šã€è»Šç·šå¢ƒç•Œã€æ¨™é«˜ï¼‰ã€Three.jsç”¨ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆã€‚
- ä¾å­˜: `fast-xml-parser`, `@osce/shared`
- ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: `Thirdparty/esmini-demo_Windows/esmini-demo/resources/xodr/`

### `packages/scenario-engine` (@osce/scenario-engine)
ã‚³ã‚¢ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€‚Zustandã‚¹ãƒˆã‚¢ã€Commandãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆUndo/Redoï¼‰ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã€è‡ªå‹•æ•´åˆã€‚
- ä¾å­˜: `zustand`, `immer`, `uuid`, `@osce/shared`

### `packages/node-editor` (@osce/node-editor)
React Flowãƒ™ãƒ¼ã‚¹ã®ãƒãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ + ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ“ãƒ¥ãƒ¼ã€‚
- ä¾å­˜: `@xyflow/react`, `dagre`, `@osce/shared`, `@osce/scenario-engine`

### `packages/3d-viewer` (@osce/3d-viewer)
Three.jsã«ã‚ˆã‚‹OpenDRIVEé“è·¯æç”» + ã‚·ãƒŠãƒªã‚ªã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è¡¨ç¤ºã€‚
- ä¾å­˜: `three`, `@react-three/fiber`, `@react-three/drei`, `@osce/shared`, `@osce/opendrive`, `@osce/scenario-engine`

### `packages/mcp-server` (@osce/mcp-server)
MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã‚¨ãƒ‡ã‚£ã‚¿æ“ä½œã‚’å…¬é–‹ã€‚AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®ã‚·ãƒŠãƒªã‚ªæ“ä½œã‚’å¯èƒ½ã«ã€‚
- ä¾å­˜: `@modelcontextprotocol/sdk`, `@osce/shared`, `@osce/scenario-engine`

### `packages/esmini` (@osce/esmini)
esminiã‚µãƒ–ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã€.datãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ¼ã‚¹ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã€‚
- ä¾å­˜: `@osce/shared`ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®ã¿ï¼‰
- å‚ç…§: `Thirdparty/esmini-demo_Windows/esmini-demo/EnvironmentSimulator/Libraries/esminiLib/esminiLib.hpp`

### `packages/templates` (@osce/templates)
ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆå‰²ã‚Šè¾¼ã¿ã€è¿½ã„è¶Šã—ç­‰ï¼‰ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®šç¾©ã€‚
- ä¾å­˜: `@osce/shared`

### `packages/i18n` (@osce/i18n)
è‹±èªãƒ»æ—¥æœ¬èªã®ç¿»è¨³ãƒªã‚½ãƒ¼ã‚¹ã€‚
- ä¾å­˜: `i18next`, `react-i18next`

### `apps/web` (@osce/web)
Reactãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’çµ±åˆã—ãŸã‚¨ãƒ‡ã‚£ã‚¿UIã€‚

### `apps/server` (@osce/server)
Node.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã€‚ãƒ•ã‚¡ã‚¤ãƒ«I/Oã€esminiãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã€WebSocketé€šä¿¡ã€‚

---

## ã‚³ã‚¢è¨­è¨ˆæ–¹é‡

### 1. å†…éƒ¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆAI-friendly JSONï¼‰

XMLã§ã¯ãªãã‚¯ãƒªãƒ¼ãƒ³ãªJSONæ§‹é€ ã‚’å†…éƒ¨è¡¨ç¾ã¨ã™ã‚‹ã€‚å…¨è¦ç´ ã«UUID `id`ã‚’ä»˜ä¸ã—ã€å®‰å®šã—ãŸå‚ç…§ã‚’å®Ÿç¾ã€‚

```typescript
// ãƒ«ãƒ¼ãƒˆ
interface ScenarioDocument {
  id: string;
  fileHeader: FileHeader;
  parameterDeclarations: ParameterDeclaration[];
  catalogLocations: CatalogLocations;
  roadNetwork: RoadNetwork;
  entities: ScenarioEntity[];
  storyboard: Storyboard;
  _editor: EditorMetadata;  // .xoscã«ã¯å‡ºåŠ›ã—ãªã„
}

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯åˆ¤åˆ¥å…±ç”¨ä½“
type PrivateAction =
  | SpeedAction        // { type: 'speedAction', ... }
  | LaneChangeAction   // { type: 'laneChangeAction', ... }
  | TeleportAction     // { type: 'teleportAction', ... }
  | ...;

// ä½ç½®ã‚‚åˆ¤åˆ¥å…±ç”¨ä½“
type Position =
  | WorldPosition      // { type: 'worldPosition', x, y, z, h, p, r }
  | LanePosition       // { type: 'lanePosition', roadId, laneId, s, offset }
  | RelativeLanePosition
  | ...;
```

**è¨­è¨ˆç†ç”±**: åˆ¤åˆ¥å…±ç”¨ä½“ã¯TypeScriptã®å‹çµã‚Šè¾¼ã¿ãŒåŠ¹ãã€AIã«ã¨ã£ã¦ã‚‚è‡ªå·±è¨˜è¿°çš„ãªJSONã€‚switchæ–‡ã§ç¶²ç¾…æ€§ãƒã‚§ãƒƒã‚¯ã‚‚å¯èƒ½ã€‚

### 2. éšå±¤çš„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 

```
ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«ï¼ˆåˆå¿ƒè€…å‘ã‘ï¼‰
  ã€Œè¿½ã„è¶Šã—ã€ã€Œå‰²ã‚Šè¾¼ã¿ã€ã€Œæ­©è¡Œè€…æ¨ªæ–­ã€...
    â”‚
    â”‚ è‡ªå‹•åˆ†è§£ (decompose)
    â–¼
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ï¼ˆä¸Šç´šè€…å‘ã‘ï¼‰
  ã€ŒåŠ é€Ÿã€ã€Œè»Šç·šå¤‰æ›´ã€ã€Œåœè»Šã€...
    â”‚
    â”‚ ç”Ÿæˆ
    â–¼
OpenSCENARIOè¦ç´ 
  Story â†’ Act â†’ ManeuverGroup â†’ Maneuver â†’ Event â†’ Action + Trigger
```

- ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¯é«˜ãƒ¬ãƒ™ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆã€Œå‰²ã‚Šè¾¼ã¿è·é›¢ã€ã€Œé€Ÿåº¦å·®ã€ç­‰ï¼‰ã‚’å…¬é–‹
- å†…éƒ¨çš„ã«Storyboardè¦ç´ ã«åˆ†è§£ã•ã‚Œã‚‹
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰æ›´æ™‚ã« **è‡ªå‹•æ•´åˆ** (reconciler) ãŒçŸ›ç›¾ã‚’è§£æ¶ˆ
- ä¸Šç´šè€…ã¯ãƒãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ã§åˆ†è§£å¾Œã®è¦ç´ ã‚’ç›´æ¥ç·¨é›†å¯èƒ½
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ **ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«è¡¨ç¤º** (visualHint: 'slider' | 'speedGauge' | 'distanceLine' ç­‰)

### 3. ãƒãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿ â†” ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®åŒæœŸ

```
ãƒãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼:                         ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ“ãƒ¥ãƒ¼:
[Storyboard]                          Time â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
  â”œâ”€[Init]
  â”‚   â”œâ”€[Ego: Teleport+Speed]        Ego:  â–ˆâ–ˆâ–ˆ 20m/s â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ>
  â”‚   â””â”€[A1: Teleport+Speed]
  â”œâ”€[Story: CutIn]                    A1:   â–ˆâ–ˆâ–ˆ 25m/s â–ˆâ–ˆâ–ˆ[LaneChg]â–ˆ>
  â”‚   â””â”€[Act]â”€[Trigger]                              â†‘
  â”‚       â””â”€[ManeuverGroup]â”€[Actor:A1]        TriggerA(è·é›¢<20m)
  â”‚           â””â”€[Maneuver]
  â”‚               â””â”€[Event]â”€[Trigger]
  â”‚                   â””â”€[Action: LaneChange]
  â””â”€[StopTrigger]
```

Zustand selection storeã§åŒæœŸ:
- ãƒãƒ¼ãƒ‰ã‚¯ãƒªãƒƒã‚¯ â†’ `selectedElementId` æ›´æ–° â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è©²å½“åŒºé–“ãƒã‚¤ãƒ©ã‚¤ãƒˆ + 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ã§ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£é¸æŠ
- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯ â†’ ãƒãƒ¼ãƒ‰ãƒ“ãƒ¥ãƒ¼ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« + ãƒã‚¤ãƒ©ã‚¤ãƒˆ

### 4. esminié€£æºï¼ˆã‚µãƒ–ãƒ—ãƒ­ã‚»ã‚¹ + .dat + WebSocketï¼‰

```
ãƒ–ãƒ©ã‚¦ã‚¶                    Node.jsã‚µãƒ¼ãƒãƒ¼              esmini.exe
  â”‚                            â”‚                          â”‚
  â”‚â”€â”€ "simulate" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                          â”‚
  â”‚                            â”‚â”€â”€ spawn â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
  â”‚                            â”‚   --headless --osc       â”‚
  â”‚                            â”‚   --record sim.dat       â”‚
  â”‚                            â”‚                          â”‚
  â”‚                            â”‚â†â”€â”€ sim.datæ›¸ãè¾¼ã¿ â”€â”€â”€â”€â”€â”€â”‚
  â”‚                            â”‚                          â”‚
  â”‚â†â”€â”€ WebSocket: ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿â”‚                          â”‚
  â”‚    { time, objects: [...] }â”‚                          â”‚
  â”‚                            â”‚                          â”‚
  â”‚(3Dãƒ“ãƒ¥ãƒ¼ã‚¢ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³) â”‚                          â”‚
```

### 5. MCPã‚µãƒ¼ãƒãƒ¼ ãƒ„ãƒ¼ãƒ«å®šç¾©ï¼ˆä¸»è¦ãªã‚‚ã®ï¼‰

| ãƒ„ãƒ¼ãƒ«å | èª¬æ˜ |
|---------|------|
| `create_scenario` | æ–°è¦ã‚·ãƒŠãƒªã‚ªä½œæˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæŒ‡å®šå¯ï¼‰ |
| `get_scenario_state` | ç¾åœ¨ã®ã‚·ãƒŠãƒªã‚ªã‚’JSONå–å¾— |
| `export_xosc` | OpenSCENARIO XMLå‡ºåŠ› |
| `add_entity` | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è¿½åŠ  |
| `add_speed_action` | é€Ÿåº¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ  |
| `add_lane_change` | è»Šç·šå¤‰æ›´ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ  |
| `apply_template` | ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé©ç”¨ |
| `validate_scenario` | ã‚·ãƒŠãƒªã‚ªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| `load_road_network` | OpenDRIVEèª­ã¿è¾¼ã¿ |
| `run_simulation` | esminiã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ |

---

## é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

### Phase 0: åŸºç›¤ã¨ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ ğŸ”´ é€æ¬¡å®Ÿè¡Œ
**å…¨å¾Œç¶šãƒ•ã‚§ãƒ¼ã‚ºã®å‰ææ¡ä»¶ã€‚ã“ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å“è³ªãŒå…¨ä½“ã‚’å·¦å³ã™ã‚‹ã€‚**

1. pnpmãƒ¢ãƒãƒ¬ãƒåˆæœŸåŒ– (`pnpm-workspace.yaml`)
2. TypeScriptè¨­å®šï¼ˆãƒ«ãƒ¼ãƒˆ + ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆ¥ï¼‰
3. `packages/shared` ã«å…¨å‹å®šç¾©ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãƒ»enumã‚’å®Ÿè£…
4. å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¹ã‚¿ãƒ– `package.json` ã‚’ä½œæˆï¼ˆä¾å­˜é–¢ä¿‚å®šç¾©ï¼‰
5. ESLint + Prettier + huskyã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
6. Vitestè¨­å®š
7. å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã« `CLAUDE_INSTRUCTIONS.md` ã‚’é…ç½®ï¼ˆå¥‘ç´„æ–‡æ›¸ï¼‰
8. å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒ `@osce/shared` ã‚’importã—ã¦ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª

**æˆæœç‰©**: å…¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©æ¸ˆã¿ã€‚å®Ÿè£…ã¯ã¾ã ãªã„ãŒã€å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ç‹¬ç«‹ã—ã¦é–‹ç™ºé–‹å§‹å¯èƒ½ã€‚

### Phase 1: ã‚³ã‚¢ã‚¨ãƒ³ã‚¸ãƒ³ + ãƒ‘ãƒ¼ã‚µãƒ¼ ğŸŸ¢ 4ä¸¦åˆ—é–‹ç™ºå¯èƒ½

| ãƒˆãƒ©ãƒƒã‚¯ | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ä¸»ãªä½œæ¥­ |
|---------|-----------|---------|
| A | `@osce/openscenario` | XMLâ†”ãƒ¢ãƒ‡ãƒ«å¤‰æ›ã€ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ—ãƒ†ã‚¹ãƒˆ |
| B | `@osce/opendrive` | é“è·¯ãƒ‘ãƒ¼ã‚¹ã€å½¢çŠ¶è¨ˆç®—ã€ãƒ¡ãƒƒã‚·ãƒ¥ç”Ÿæˆ |
| C | `@osce/scenario-engine` | Zustandã‚¹ãƒˆã‚¢ã€Command/Undoã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ  |
| D | `@osce/i18n` + `@osce/templates` | ç¿»è¨³ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ6-8ç¨® |

### Phase 2: ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ‡ã‚£ã‚¿ ğŸŸ¢ 3ä¸¦åˆ—é–‹ç™ºå¯èƒ½

| ãƒˆãƒ©ãƒƒã‚¯ | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ä¸»ãªä½œæ¥­ |
|---------|-----------|---------|
| E | `@osce/node-editor` | ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒ‰ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‘ãƒãƒ« |
| F | `@osce/3d-viewer` | é“è·¯æç”»ã€è»Šç·šè¡¨ç¤ºã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€ãƒ¬ãƒ¼ãƒ³IDè¡¨ç¤º |
| G | `apps/web` | ãƒ¡ã‚¤ãƒ³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã€ãƒ‘ãƒãƒ«çµ±åˆã€ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ |

### Phase 3: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ + çµ±åˆ ğŸŸ¢ 3ä¸¦åˆ—é–‹ç™ºå¯èƒ½

| ãƒˆãƒ©ãƒƒã‚¯ | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ä¸»ãªä½œæ¥­ |
|---------|-----------|---------|
| H | `apps/server` | Fastifyã‚µãƒ¼ãƒãƒ¼ã€WebSocketã€ãƒ•ã‚¡ã‚¤ãƒ«I/O |
| I | `@osce/esmini` | ã‚µãƒ–ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã€.datãƒ‘ãƒ¼ã‚µãƒ¼ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° |
| J | `@osce/mcp-server` | MCPãƒ„ãƒ¼ãƒ«å®Ÿè£…ã€ãƒªã‚½ãƒ¼ã‚¹å®šç¾© |

### Phase 4: çµ±åˆãƒ†ã‚¹ãƒˆ + ãƒãƒªãƒƒã‚·ãƒ¥ ğŸ”´ å…¨ãƒˆãƒ©ãƒƒã‚¯åˆæµ

- E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰
- ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ—ãƒ†ã‚¹ãƒˆï¼ˆ.xosc â†’ ç·¨é›† â†’ ä¿å­˜ â†’ ãƒ­ãƒ¼ãƒ‰ â†’ æ¤œè¨¼ï¼‰
- esminiçµ±åˆãƒ†ã‚¹ãƒˆ
- MCPçµ±åˆãƒ†ã‚¹ãƒˆ
- æ—¥æœ¬èªç¿»è¨³ãƒ¬ãƒ“ãƒ¥ãƒ¼
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### å°†æ¥ãƒ•ã‚§ãƒ¼ã‚º
- Tauriãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒª (`apps/desktop`)
- OpenSCENARIO v2.0 DSLå¯¾å¿œ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- OpenDRIVEã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¿½åŠ 

---

## ä¸¦åˆ—é–‹ç™ºæˆ¦ç•¥ï¼ˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼‰

**æ ¸å¿ƒ**: `packages/shared` ãŒå…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸é–“ã®ã€Œå¥‘ç´„ã€ã€‚Phase 0ã§ç¢ºå®šã—ã€ä»¥é™ã¯å¤‰æ›´ã—ãªã„ï¼ˆã‚„ã‚€ã‚’å¾—ãªã„å ´åˆã¯ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒèª¿æ•´ï¼‰ã€‚

å„Claude Codeã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ãƒ«ãƒ¼ãƒ«:
1. `packages/shared/src/` ã‚’ç†Ÿèª­ â€” ã“ã‚ŒãŒå¥‘ç´„
2. è‡ªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `CLAUDE_INSTRUCTIONS.md` ã«å¾“ã†
3. `packages/shared` ã¯ **çµ¶å¯¾ã«å¤‰æ›´ã—ãªã„**ï¼ˆå‹å¤‰æ›´ãŒå¿…è¦ãªã‚‰å ±å‘Šï¼‰
4. ä»–ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å®Ÿè£…ã§ã¯ãªãã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«å¯¾ã—ã¦ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
5. ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚’æ›¸ã
6. `Thirdparty/` ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµ±åˆãƒ†ã‚¹ãƒˆã«ä½¿ç”¨
7. `src/index.ts` ã§ã‚¯ãƒªãƒ¼ãƒ³ãªå…¬é–‹APIã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

---

## é‡è¦ãªå‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” |
|---------|------|
| `Thirdparty/openscenario-v1.2.0/Schema/OpenSCENARIO.xsd` | å…¨OpenSCENARIOå‹ã®æ¨©å¨çš„ã‚½ãƒ¼ã‚¹ |
| `Thirdparty/openscenario-v1.2.0/Examples/CutIn.xosc` | ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ—ãƒ†ã‚¹ãƒˆç”¨ |
| `Thirdparty/opendrive/xsd_schema/opendrive_16_*.xsd` | OpenDRIVEå‹ã®ã‚½ãƒ¼ã‚¹ |
| `Thirdparty/esmini-demo_Windows/esmini-demo/EnvironmentSimulator/Libraries/esminiLib/esminiLib.hpp` | esmini C APIå®šç¾© |
| `Thirdparty/esmini-demo_Windows/esmini-demo/resources/xosc/` | ãƒ†ã‚¹ãƒˆç”¨ã‚·ãƒŠãƒªã‚ªç¾¤ |
| `Thirdparty/esmini-demo_Windows/esmini-demo/resources/xodr/` | ãƒ†ã‚¹ãƒˆç”¨é“è·¯ãƒ‡ãƒ¼ã‚¿ç¾¤ |

---

## æ¤œè¨¼æ–¹æ³•

1. **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**: `pnpm test` â€” å…¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Vitestãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
2. **å‹ãƒã‚§ãƒƒã‚¯**: `pnpm typecheck` â€” TypeScriptå‹æ•´åˆæ€§ã®ç¢ºèª
3. **ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ—**: ã‚µãƒ³ãƒ—ãƒ«.xoscã‚’èª­ã¿è¾¼ã¿ â†’ å†…éƒ¨ãƒ¢ãƒ‡ãƒ« â†’ .xoscæ›¸ãå‡ºã— â†’ å†…å®¹æ¯”è¼ƒ
4. **3Dãƒ“ãƒ¥ãƒ¼ã‚¢**: ã‚µãƒ³ãƒ—ãƒ«.xodrã‚’èª­ã¿è¾¼ã¿ â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã§é“è·¯ãŒæ­£ã—ãæç”»ã•ã‚Œã‚‹ã‹ç¢ºèª
5. **ãƒãƒ¼ãƒ‰ã‚¨ãƒ‡ã‚£ã‚¿**: ã‚µãƒ³ãƒ—ãƒ«.xoscã‚’èª­ã¿è¾¼ã¿ â†’ ãƒãƒ¼ãƒ‰ãŒæ­£ã—ãé…ç½®ã•ã‚Œã‚‹ã‹ç¢ºèª
6. **MCP**: Claudeç­‰ã®MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã—ã¦ã‚·ãƒŠãƒªã‚ªæ“ä½œ
7. **esmini**: ã‚µãƒ³ãƒ—ãƒ«ã‚·ãƒŠãƒªã‚ªã‚’å®Ÿè¡Œ â†’ 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
8. **E2Eãƒ†ã‚¹ãƒˆ**: `pnpm test:e2e` â€” Playwrightã«ã‚ˆã‚‹ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œãƒ†ã‚¹ãƒˆ
9. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: å„ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é©ç”¨ â†’ ç”Ÿæˆã•ã‚ŒãŸ.xoscã‚’esminiã§å®Ÿè¡Œå¯èƒ½ã‹ç¢ºèª

---

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¾å­˜ã‚°ãƒ©ãƒ•

```
@osce/shared          â† ä¾å­˜ãªã— (ç´”ç²‹å‹å®šç¾©)
    ^
    |
    +-- @osce/openscenario     â† shared, fast-xml-parser
    +-- @osce/opendrive        â† shared, fast-xml-parser
    +-- @osce/scenario-engine  â† shared, zustand, immer, uuid
    +-- @osce/i18n             â† shared, i18next, react-i18next
    +-- @osce/templates        â† shared
    +-- @osce/esmini           â† shared (server-side only)
    |
    +-- @osce/node-editor      â† shared, scenario-engine, @xyflow/react, dagre
    +-- @osce/3d-viewer        â† shared, opendrive, scenario-engine, three, @react-three/fiber
    +-- @osce/mcp-server       â† shared, scenario-engine, @modelcontextprotocol/sdk
    |
    +-- apps/web               â† ALL frontend packages
    +-- apps/server            â† shared, openscenario, esmini, mcp-server
```
